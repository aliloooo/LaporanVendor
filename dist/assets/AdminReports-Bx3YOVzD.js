import{j as e,s as m}from"./index-B9GCynK_.js";import{r as l}from"./vendor-C2YDr15k.js";import{g as U,L as u,D,l as R,f as T,b as G,h as H,T as V}from"./ui-BsoBaXac.js";import{f as A}from"./format-BoGrmgZv.js";import"./data-CpkYhZGa.js";import"./toDate-SX-ecmdR.js";const L={uploaded:{label:"Uploaded",color:"text-green-700",bg:"bg-green-100",icon:U},overdue:{label:"Overdue",color:"text-red-700",bg:"bg-red-100",icon:T},pending:{label:"Pending",color:"text-yellow-700",bg:"bg-yellow-100",icon:H}},B=({title:h,message:f,onConfirm:g,onClose:c,loading:i})=>e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:h}),e.jsx("p",{className:"text-slate-500 text-sm mb-6",children:f}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:c,className:"px-4 py-2 border border-slate-300 rounded-lg text-slate-700 hover:bg-slate-50",children:"Batal"}),e.jsxs("button",{onClick:g,disabled:i,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-60 flex items-center gap-2",children:[i&&e.jsx(u,{className:"w-4 h-4 animate-spin"})," Hapus"]})]})]})}),X=()=>{const[h,f]=l.useState([]),[g,c]=l.useState(!0),[i,n]=l.useState(""),[y,w]=l.useState(""),[p,E]=l.useState(""),[b,$]=l.useState("all"),[r,x]=l.useState(null),[M,N]=l.useState(!1),[S,C]=l.useState(null),[_,k]=l.useState(!1),j=async()=>{c(!0),n("");try{const{data:t,error:s}=await m.from("report_uploads").select(`
                    *,
                    vendors ( name ),
                    report_types ( name )
                `).order("uploaded_at",{ascending:!1});if(s)throw s;f(t||[])}catch(t){console.error("Error loading admin reports:",t),n(t.message)}finally{c(!1)}};l.useEffect(()=>{j()},[]);const v=t=>{w(t),setTimeout(()=>w(""),3e3)},I=async(t,s)=>{C(t);try{const{error:a}=await m.from("report_uploads").update({status:s}).eq("id",t);if(a)throw a;v("Status berhasil diperbarui!"),await j()}catch(a){n(`Gagal memperbarui status: ${a.message}`)}finally{C(null)}},F=async()=>{if(o.length!==0){k(!0);try{for(const t of o)if(t.file_url){const s=document.createElement("a");s.href=t.file_url,s.download=`${t.vendors?.name||"Report"}-${t.report_types?.name||"File"}`,s.target="_blank",document.body.appendChild(s),s.click(),s.remove(),await new Promise(a=>setTimeout(a,500))}v("Semua laporan sedang diunduh.")}catch(t){n(`Gagal mengunduh: ${t.message}`)}finally{k(!1)}}},O=async()=>{if(r){N(!0),n("");try{let t=null;if(r.file_url){const a="/object/public/vendor-reports/",d=r.file_url.indexOf(a);d!==-1&&(t=r.file_url.substring(d+a.length).split("?")[0])}t&&await m.storage.from("vendor-reports").remove([decodeURIComponent(t)]);const{error:s}=await m.from("report_uploads").delete().eq("id",r.id);if(s)throw s;v("Laporan berhasil dihapus!"),x(null),await j()}catch(t){n(`Gagal menghapus: ${t.message}`),x(null)}finally{N(!1)}}},o=h.filter(t=>{const s=t.vendors?.name||"",a=t.report_types?.name||"",d=s.toLowerCase().includes(p.toLowerCase())||a.toLowerCase().includes(p.toLowerCase()),P=b==="all"||t.status===b;return d&&P});return e.jsxs("div",{className:"space-y-6",children:[y&&e.jsxs("div",{className:"fixed top-4 right-4 z-50 bg-green-600 text-white px-4 py-3 rounded-xl shadow-lg flex items-center gap-2",children:[e.jsx(U,{className:"w-5 h-5"})," ",y]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Manage Vendor Reports"}),e.jsx("p",{className:"text-slate-500 text-sm mt-1",children:"Kelola hasil submit laporan dari seluruh vendor."})]}),o.length>0&&e.jsxs("button",{onClick:F,disabled:_,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-xl text-sm font-bold hover:bg-blue-700 transition-all shadow-md shadow-blue-200 disabled:opacity-60 disabled:shadow-none",children:[_?e.jsx(u,{className:"w-4 h-4 animate-spin"}):e.jsx(D,{className:"w-4 h-4"}),"Download All (",o.length,")"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(R,{className:"w-4 h-4 text-slate-400 absolute left-3 top-1/2 -translate-y-1/2"}),e.jsx("input",{type:"text",placeholder:"Cari vendor atau jenis laporan...",value:p,onChange:t=>E(t.target.value),className:"w-full pl-9 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm"})]}),e.jsxs("select",{value:b,onChange:t=>$(t.target.value),className:"border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none bg-white",children:[e.jsx("option",{value:"all",children:"Semua Status"}),e.jsx("option",{value:"uploaded",children:"Uploaded"}),e.jsx("option",{value:"overdue",children:"Overdue"}),e.jsx("option",{value:"pending",children:"Pending"})]})]}),i&&e.jsxs("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 rounded-r-lg text-sm text-red-700 flex items-center gap-2",children:[e.jsx(T,{className:"w-4 h-4"})," ",i]}),g?e.jsx("div",{className:"flex justify-center py-24",children:e.jsx(u,{className:"w-8 h-8 animate-spin text-blue-600"})}):e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-slate-700",children:"Vendor"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-slate-700",children:"Jenis Laporan"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-slate-700",children:"Bulan"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-slate-700",children:"Upload At"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-slate-700",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-center font-semibold text-slate-700",children:"Aksi"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:o.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-24 text-center text-slate-400",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(G,{className:"w-12 h-12 opacity-10"}),e.jsxs("p",{children:["Belum ada laporan vendor",p?" yang sesuai pencarian.":"."]})]})})}):o.map(t=>{const s=L[t.status]||L.pending,a=s.icon;return e.jsxs("tr",{className:"hover:bg-slate-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 font-medium text-slate-900",children:t.vendors?.name||"—"}),e.jsx("td",{className:"px-6 py-4 text-slate-600 truncate max-w-[150px]",children:t.report_types?.name||"—"}),e.jsx("td",{className:"px-6 py-4 text-slate-500 whitespace-nowrap",children:t.report_month?A(new Date(t.report_month),"MMM yyyy"):"—"}),e.jsx("td",{className:"px-6 py-4 text-slate-500 whitespace-nowrap",children:t.uploaded_at?A(new Date(t.uploaded_at),"dd/MM/yy HH:mm"):"—"}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"relative group/status",children:[e.jsxs("select",{value:t.status,disabled:S===t.id,onChange:d=>I(t.id,d.target.value),className:`
                                                                appearance-none cursor-pointer inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider border-0 focus:ring-2 focus:ring-blue-500 outline-none transition-all
                                                                ${s.bg} ${s.color}
                                                            `,children:[e.jsx("option",{value:"uploaded",children:"Uploaded"}),e.jsx("option",{value:"overdue",children:"Overdue"}),e.jsx("option",{value:"pending",children:"Pending"})]}),S===t.id?e.jsx(u,{className:"w-3 h-3 animate-spin absolute right-1 top-1/2 -translate-y-1/2 opacity-50"}):e.jsx(a,{className:"w-3 h-3 absolute right-2 top-1/2 -translate-y-1/2 pointer-events-none"})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[t.file_url&&e.jsx("a",{href:t.file_url,target:"_blank",rel:"noreferrer",className:"p-1.5 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg",children:e.jsx(D,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>x(t),className:"p-1.5 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-lg",children:e.jsx(V,{className:"w-4 h-4"})})]})})]},t.id)})})]})})}),r&&e.jsx(B,{title:"Hapus Laporan",message:`Apakah Anda yakin ingin menghapus "${r.report_types?.name||"laporan ini"}"?`,onConfirm:O,onClose:()=>x(null),loading:M})]})};export{X as default};
