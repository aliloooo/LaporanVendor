import{j as e}from"./index-B9GCynK_.js";import{r as n}from"./vendor-C2YDr15k.js";import{g as M,c as I,u as U,d as A}from"./adminService-BiK4lHYw.js";import{g as B,P as $,L as N,m as L,b as P,c as H,D as R,n as q,T as z,X as G}from"./ui-BsoBaXac.js";import{f as K}from"./format-BoGrmgZv.js";import"./data-CpkYhZGa.js";import"./toDate-SX-ecmdR.js";const O=10*1024*1024,f={excel:{label:"Excel",icon:H,color:"text-green-600",bg:"bg-green-50",accept:".xlsx"},word:{label:"Word",icon:P,color:"text-blue-600",bg:"bg-blue-50",accept:".docx"},pdf:{label:"PDF",icon:L,color:"text-red-600",bg:"bg-red-50",accept:".pdf"}},y=["Financial","Operational","SLA","Compliance","Maintenance","HSE","General"],T=({title:s,children:c,onClose:d})=>e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-lg",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:s}),e.jsx("button",{onClick:d,className:"p-1 hover:bg-slate-100 rounded-lg",children:e.jsx(G,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-6",children:c})]})}),W=({message:s,onConfirm:c,onClose:d,loading:a})=>e.jsxs(T,{title:"Konfirmasi Hapus",onClose:d,children:[e.jsx("p",{className:"text-slate-600 mb-6",children:s}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:d,className:"px-4 py-2 border border-slate-300 rounded-lg text-slate-700 hover:bg-slate-50",children:"Batal"}),e.jsxs("button",{onClick:c,disabled:a,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-60 flex items-center gap-2",children:[a&&e.jsx(N,{className:"w-4 h-4 animate-spin"})," Hapus"]})]})]}),X=({t:s,onEdit:c,onDelete:d})=>{const a=f[s.file_type]||f.pdf,o=a.icon;return e.jsxs("tr",{className:"hover:bg-slate-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 ${a.bg} rounded-lg`,children:e.jsx(o,{className:`w-4 h-4 ${a.color}`})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-900",children:s.name}),e.jsx("p",{className:"text-xs text-slate-400",children:s.category})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${a.bg} ${a.color}`,children:a.label})}),e.jsx("td",{className:"px-6 py-4 text-slate-500 text-sm",children:K(new Date(s.updated_at||s.created_at),"dd MMM yyyy")}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("a",{href:s.file_url,target:"_blank",rel:"noopener noreferrer",className:"p-1.5 text-slate-500 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Download",children:e.jsx(R,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>c(s),className:"p-1.5 text-slate-500 hover:text-amber-600 hover:bg-amber-50 rounded-lg transition-colors",title:"Edit",children:e.jsx(q,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>d(s),className:"p-1.5 text-slate-500 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Hapus",children:e.jsx(z,{className:"w-4 h-4"})})]})})]})},le=()=>{const[s,c]=n.useState([]),[d,a]=n.useState(!0),[o,i]=n.useState(""),[k,C]=n.useState(""),[S,b]=n.useState(!1),[m,x]=n.useState(null),[g,v]=n.useState(null),[u,p]=n.useState(!1),[r,h]=n.useState({name:"",category:y[0],file_type:"excel",file:null}),j=async()=>{try{c(await M())}catch(t){i(t.message)}finally{a(!1)}};n.useEffect(()=>{j()},[]);const w=t=>{C(t),setTimeout(()=>C(""),3e3)},_=async t=>{if(t.preventDefault(),!r.file)return i("File wajib dipilih");if(r.file.size>O)return i("File maks 10MB");const l=f[r.file_type].accept;if(!r.file.name.endsWith(l))return i(`Tipe file harus ${l} untuk kategori ${r.file_type}`);p(!0);try{await I(r),w("Template berhasil diupload!"),b(!1),h({name:"",category:y[0],file_type:"excel",file:null}),await j()}catch(D){i(D.message)}finally{p(!1)}},E=async t=>{t.preventDefault(),p(!0);try{await U(m.id,{name:m.name,category:m.category}),w("Template berhasil diupdate!"),x(null),await j()}catch(l){i(l.message)}finally{p(!1)}},F=async()=>{p(!0);try{await A(g.id,g.file_path),w("Template berhasil dihapus!"),v(null),await j()}catch(t){i(t.message)}finally{p(!1)}};return s.filter(t=>t.file_type==="excel"),s.filter(t=>t.file_type==="word"),s.filter(t=>t.file_type==="pdf"),e.jsxs("div",{className:"space-y-6",children:[k&&e.jsxs("div",{className:"fixed top-4 right-4 z-50 bg-green-600 text-white px-4 py-3 rounded-xl shadow-lg flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5"})," ",k]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Template Management"}),e.jsx("p",{className:"text-slate-500 text-sm mt-1",children:"Upload & kelola template laporan yang bisa didownload vendor."})]}),e.jsxs("button",{onClick:()=>{b(!0),i("")},className:"w-full sm:w-auto flex items-center justify-center gap-2 px-4 py-2.5 bg-blue-600 text-white rounded-xl hover:bg-blue-700 font-medium",children:[e.jsx($,{className:"w-5 h-5"})," Upload Template"]})]}),o&&e.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 rounded-r-lg text-sm text-red-700",children:o}),d?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(N,{className:"w-8 h-8 animate-spin text-blue-600"})}):e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-slate-700",children:"Nama Template"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-slate-700",children:"Tipe"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-slate-700",children:"Terakhir Update"}),e.jsx("th",{className:"px-6 py-3 text-center font-semibold text-slate-700",children:"Aksi"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:s.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-6 py-10 text-center text-slate-400",children:"Belum ada template. Mulai upload template pertama Anda."})}):s.map(t=>e.jsx(X,{t,onEdit:l=>{x(l),i("")},onDelete:l=>{v(l),i("")}},t.id))})]})})}),S&&e.jsx(T,{title:"Upload Template Baru",onClose:()=>b(!1),children:e.jsxs("form",{onSubmit:_,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Nama Template * (harus unik)"}),e.jsx("input",{value:r.name,onChange:t=>h(l=>({...l,name:t.target.value})),required:!0,className:"w-full border border-slate-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"e.g., SLA Report Template"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Kategori *"}),e.jsx("select",{value:r.category,onChange:t=>h(l=>({...l,category:t.target.value})),className:"w-full border border-slate-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 outline-none",children:y.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Tipe File *"}),e.jsxs("select",{value:r.file_type,onChange:t=>h(l=>({...l,file_type:t.target.value,file:null})),className:"w-full border border-slate-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 outline-none",children:[e.jsx("option",{value:"excel",children:"Excel (.xlsx)"}),e.jsx("option",{value:"word",children:"Word (.docx)"}),e.jsx("option",{value:"pdf",children:"PDF (.pdf)"})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:["File (",f[r.file_type].accept,", maks 10MB) *"]}),e.jsx("input",{type:"file",accept:f[r.file_type].accept,onChange:t=>h(l=>({...l,file:t.target.files[0]})),required:!0,className:"block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"})]}),o&&e.jsx("p",{className:"text-sm text-red-600",children:o}),e.jsxs("div",{className:"flex gap-3 justify-end pt-2",children:[e.jsx("button",{type:"button",onClick:()=>b(!1),className:"px-4 py-2 border border-slate-300 rounded-lg text-slate-700 hover:bg-slate-50",children:"Batal"}),e.jsxs("button",{type:"submit",disabled:u,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-60 flex items-center gap-2",children:[u&&e.jsx(N,{className:"w-4 h-4 animate-spin"})," Upload"]})]})]})}),m&&e.jsx(T,{title:"Edit Template",onClose:()=>x(null),children:e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Nama Template *"}),e.jsx("input",{value:m.name,onChange:t=>x(l=>({...l,name:t.target.value})),required:!0,className:"w-full border border-slate-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Kategori *"}),e.jsx("select",{value:m.category,onChange:t=>x(l=>({...l,category:t.target.value})),className:"w-full border border-slate-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 outline-none",children:y.map(t=>e.jsx("option",{value:t,children:t},t))})]}),o&&e.jsx("p",{className:"text-sm text-red-600",children:o}),e.jsxs("div",{className:"flex gap-3 justify-end pt-2",children:[e.jsx("button",{type:"button",onClick:()=>x(null),className:"px-4 py-2 border border-slate-300 rounded-lg text-slate-700 hover:bg-slate-50",children:"Batal"}),e.jsxs("button",{type:"submit",disabled:u,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-60 flex items-center gap-2",children:[u&&e.jsx(N,{className:"w-4 h-4 animate-spin"})," Simpan"]})]})]})}),g&&e.jsx(W,{message:`Hapus template "${g.name}"? File di storage juga akan dihapus.`,onConfirm:F,onClose:()=>v(null),loading:u})]})};export{le as default};
