import{s as C,j as e}from"./index-CT63F8Oz.js";import{R,r as g}from"./vendor-C2YDr15k.js";import{b as q,g as V,h as F,f as T,i as G,j as Q,L as W}from"./ui-BsoBaXac.js";import{c as U,d as B}from"./dateHelper-uiqc6hDl.js";import"./data-CpkYhZGa.js";import"./toDate-SX-ecmdR.js";const X=async(l=new Date().getFullYear())=>{try{const i=`${l}-01-01`,u=`${l}-12-31`,[m,c,t,d]=await Promise.all([C.from("vendors").select("id, name").order("name"),C.from("report_types").select("*").order("id"),C.from("report_uploads").select("*").gte("report_month",i).lte("report_month",u),C.from("report_uploads").select("report_month").order("report_month",{ascending:!0})]);if(m.error)throw m.error;if(c.error)throw c.error;if(t.error)throw t.error;if(d.error)throw d.error;const a=m.data,s=c.data,n=t.data,b=d.data,j={totalVendors:a.length,totalReports:s.length*a.length,uploaded:n.filter(f=>f.status==="uploaded").length,pending:n.filter(f=>f.status==="pending").length,overdue:n.filter(f=>f.status==="overdue").length},p=new Set;b.forEach(f=>{const w=f.report_month.split("-")[0];p.add(parseInt(w))}),p.add(new Date().getFullYear());const N=Array.from(p).sort((f,w)=>w-f);return{uploads:n,summary:j,vendors:a,reportTypes:s,year:l,availableYears:N}}catch(i){throw console.error("Error fetching dashboard data:",i),i}},$=({title:l,count:i,icon:u,colorClass:m,bgColorClass:c,iconColorClass:t})=>e.jsxs("div",{className:"group bg-white rounded-2xl shadow-sm border border-slate-100 p-6 flex items-center space-x-5 transition-all duration-300 hover:shadow-md hover:border-blue-100",children:[e.jsx("div",{className:`p-4 rounded-xl ${c} transition-transform duration-300 group-hover:scale-110`,children:e.jsx(u,{className:`w-7 h-7 ${t}`})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest mb-1",children:l}),e.jsx("p",{className:`text-3xl font-bold tracking-tight ${m}`,children:i})]})]}),Z=({summary:l})=>e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx($,{title:"Total Laporan",count:l.totalReports,icon:q,colorClass:"text-slate-900",bgColorClass:"bg-blue-50",iconColorClass:"text-blue-600"}),e.jsx($,{title:"Terkirim",count:l.uploaded,icon:V,colorClass:"text-green-600",bgColorClass:"bg-green-50",iconColorClass:"text-green-600"}),e.jsx($,{title:"Tertunda",count:l.pending,icon:F,colorClass:"text-yellow-600",bgColorClass:"bg-yellow-50",iconColorClass:"text-yellow-600"}),e.jsx($,{title:"Terlambat",count:l.overdue,icon:T,colorClass:"text-red-600",bgColorClass:"bg-red-50",iconColorClass:"text-red-600"})]}),I=[{value:1,label:"Jan"},{value:2,label:"Feb"},{value:3,label:"Mar"},{value:4,label:"Apr"},{value:5,label:"May"},{value:6,label:"Jun"},{value:7,label:"Jul"},{value:8,label:"Aug"},{value:9,label:"Sep"},{value:10,label:"Oct"},{value:11,label:"Nov"},{value:12,label:"Dec"}],ee=({status:l})=>{switch(l){case"uploaded":return e.jsx(V,{className:"w-5 h-5 text-green-500 mx-auto",title:"Uploaded"});case"pending":return e.jsx(F,{className:"w-5 h-5 text-yellow-500 mx-auto",title:"Pending"});case"overdue":return e.jsx(T,{className:"w-5 h-5 text-red-500 mx-auto",title:"Overdue"});default:return e.jsx(G,{className:"w-4 h-4 text-slate-300 mx-auto",title:"Not Uploaded"})}},te=R.memo(({vendors:l,reportTypes:i,uploadLookup:u,year:m})=>{const c=new Date,t=g.useMemo(()=>I.map(a=>{const s=new Date(m,a.value-1,1),n=`${m}-${String(a.value).padStart(2,"0")}`,b=s>c,j=new Map;return i.forEach(p=>{j.set(p.id,U(s,p))}),{value:a.value,reportMonth:s,monthPrefix:n,isFuture:b,dueDates:j}}),[m,i]),d=(a,s,n)=>{const b=`${a}_${s}_${n.monthPrefix}`,j=u?.get(b);if(j){const p=n.dueDates.get(s);return B(!0,p,j.uploaded_at)}return n.isFuture?null:"pending"};return e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-4 py-3 font-semibold text-slate-700 min-w-[250px] sticky left-0 bg-slate-50 z-10 border-r border-slate-200",children:"Jenis Laporan"}),I.map(a=>e.jsx("th",{scope:"col",className:"px-2 py-3 font-semibold text-slate-700 text-center min-w-[60px]",children:a.label},a.value))]})}),e.jsx("tbody",{className:"divide-y divide-slate-200",children:l.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"13",className:"px-6 py-8 text-center text-slate-500",children:"Tidak ada data vendor."})}):l.map(a=>e.jsxs(R.Fragment,{children:[e.jsx("tr",{className:"bg-blue-50/50",children:e.jsx("td",{colSpan:"13",className:"px-4 py-2 font-bold text-slate-900 sticky left-0 bg-blue-50/50",children:a.name})}),i.map(s=>e.jsxs("tr",{className:"hover:bg-slate-50/50 transition-colors",children:[e.jsx("td",{className:"px-4 py-2.5 text-slate-600 text-xs font-medium sticky left-0 bg-white group-hover:bg-slate-50 border-r border-slate-100",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:s.name}),e.jsx("span",{className:"text-[10px] text-slate-400 capitalize",children:s.period_type.replace("_"," ")})]})}),t.map(n=>{const b=d(a.id,s.id,n);return e.jsx("td",{className:"px-2 py-2.5 text-center border-l border-slate-100",children:e.jsx(ee,{status:b})},`${a.id}-${s.id}-${n.value}`)})]},`${a.id}-${s.id}`))]},a.id))})]})})})}),se=R.memo(({vendorStats:l,onSelectVendor:i,selectedVendorId:u,summaryMonth:m,setSummaryMonth:c})=>e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:[e.jsxs("div",{className:"p-5 border-b border-slate-100 flex flex-col sm:flex-row justify-between items-start sm:items-center bg-slate-50/50 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-800 text-lg",children:"Ringkasan Kepatuhan Vendor"}),e.jsxs("span",{className:"text-sm text-slate-500",children:[l.length," Total Vendor"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 uppercase",children:"Bulan:"}),e.jsxs("select",{value:m,onChange:t=>c(t.target.value),className:"rounded-lg border border-slate-200 px-3 py-1.5 bg-white text-sm font-medium focus:ring-2 focus:ring-blue-500 outline-none transition-colors hover:border-blue-300",children:[e.jsx("option",{value:"all",children:"Semua Bulan"}),Array.from({length:12},(t,d)=>d+1).map(t=>{const d=new Date(2e3,t-1);return e.jsx("option",{value:t,children:d.toLocaleString("id-ID",{month:"long"})},t)})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-slate-50 text-slate-600 font-semibold uppercase text-xs tracking-wider",children:[e.jsx("th",{className:"px-6 py-4",children:"Nama Vendor"}),e.jsx("th",{className:"px-6 py-4 text-center",children:"Persentase"}),e.jsx("th",{className:"px-6 py-4",children:"Uploaded"}),e.jsx("th",{className:"px-6 py-4",children:"Overdue"}),e.jsx("th",{className:"px-6 py-4",children:"Pending"}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Aksi"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:l.map(t=>{const d=t.totalReports>0?Math.round(t.uploaded/t.totalReports*100):0,a=t.id===u;return e.jsxs("tr",{className:`group hover:bg-blue-50/40 transition-colors duration-200 ${a?"bg-blue-50/60 border-l-4 border-blue-500":"border-l-4 border-transparent"}`,children:[e.jsx("td",{className:"px-6 py-4 font-medium text-slate-900",children:t.name}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("div",{className:"flex-1 min-w-[60px] h-2 bg-slate-100 rounded-full overflow-hidden max-w-[100px] group-hover:h-2.5 transition-all",children:e.jsx("div",{className:`h-full rounded-full transition-all duration-500 ${d>=90?"bg-green-500":d>=70?"bg-yellow-500":"bg-red-500"}`,style:{width:`${d}%`}})}),e.jsxs("span",{className:"font-semibold text-slate-700 whitespace-nowrap",children:[d,"%"]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center text-green-600 font-medium",children:[e.jsx(V,{className:"w-4 h-4 mr-1.5"}),t.uploaded]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center text-red-600 font-medium",children:[e.jsx(T,{className:"w-4 h-4 mr-1.5"}),t.overdue]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center text-yellow-600 font-medium",children:[e.jsx(F,{className:"w-4 h-4 mr-1.5"}),t.pending]})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("button",{onClick:()=>i(t.id),className:`inline-flex items-center px-3 py-1.5 rounded-lg text-sm font-semibold transition-all ${a?"bg-blue-600 text-white shadow-md":"bg-white text-blue-600 border border-blue-200 hover:bg-blue-50"}`,children:[a?"Melihat Matriks":"Detail",!a&&e.jsx(Q,{className:"w-4 h-4 ml-1"})]})})]},t.id)})})]})}),l.length===0&&e.jsx("div",{className:"p-10 text-center text-slate-500 italic",children:"Belum ada data statistik untuk tahun ini."})]})),ce=()=>{const[l,i]=g.useState([]),[u,m]=g.useState([]),[c,t]=g.useState([]),[d,a]=g.useState(null),[s,n]=g.useState(new Date().getFullYear()),[b,j]=g.useState("all"),[p,N]=g.useState(""),[f,w]=g.useState([new Date().getFullYear()]),[D,Y]=g.useState(!0);g.useEffect(()=>{(async()=>{try{const h=await X(s);i(h.uploads),m(h.vendors),t(h.reportTypes),h.vendors.length>0&&!p&&N(h.vendors[0].id),w(h.availableYears||[s]),a(h.summary),n(h.year)}catch(h){console.error("Failed to load dashboard data",h)}finally{Y(!1)}})()},[s]);const S=g.useMemo(()=>{if(D||u.length===0||c.length===0)return{global:null,perVendor:[]};const r=new Date,h=r.getFullYear(),J=r.getMonth()+1,_=new Map;l.forEach(o=>{if(o.report_month){const x=o.report_month.substring(0,7),k=`${o.vendor_id}_${o.report_type_id}_${x}`;_.set(k,o)}});const y=u.map(o=>{let x=0,k=0,M=0;return c.forEach(E=>{for(let v=1;v<=12;v++){const O=`${s}-${String(v).padStart(2,"0")}`,K=new Date(s,v-1,1);if(b!=="all"&&v!==parseInt(b,10)||s>h||s===h&&v>J)continue;const z=`${o.id}_${E.id}_${O}`,P=_.get(z);if(P){const H=U(K,E),A=B(!0,H,P.uploaded_at);A==="uploaded"?x++:A==="overdue"&&M++}else k++}}),{id:o.id,name:o.name,uploaded:x,overdue:M,pending:k,totalReports:x+M+k}});return{global:{totalReports:y.reduce((o,x)=>o+(x.uploaded+x.overdue),0),uploaded:y.reduce((o,x)=>o+x.uploaded,0),pending:y.reduce((o,x)=>o+x.pending,0),overdue:y.reduce((o,x)=>o+x.overdue,0)},perVendor:y,uploadLookup:_}},[l,u,c,s,D,b]);if(D)return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] text-slate-500",children:[e.jsx(W,{className:"w-8 h-8 animate-spin mb-4 text-blue-600"}),e.jsx("p",{children:"Loading dashboard data..."})]});const L=u.filter(r=>r.id===p);return e.jsxs("div",{className:"space-y-10 pb-16",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-6",children:[e.jsxs("div",{className:"flex flex-col space-y-2 border-l-4 border-blue-600 pl-6 py-1",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight text-slate-900",children:"Dashboard Monitoring"}),e.jsx("p",{className:"text-slate-500 font-medium",children:"Ringkasan eksekutif dan matriks kepatuhan laporan vendor."})]}),e.jsxs("div",{className:"bg-white p-2 rounded-2xl shadow-sm border border-slate-100 flex items-center gap-3",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest pl-3",children:"Periode"}),e.jsx("select",{value:s,onChange:r=>{Y(!0),n(Number(r.target.value))},className:"rounded-xl border-none px-4 py-2 bg-slate-50 text-slate-800 text-sm font-bold focus:ring-2 focus:ring-blue-500 outline-none transition-all cursor-pointer hover:bg-slate-100",children:f.map(r=>e.jsxs("option",{value:r,children:["Tahun ",r]},r))})]})]}),S.global&&e.jsx("div",{className:"animate-in fade-in slide-in-from-bottom-4 duration-700",children:e.jsx(Z,{summary:S.global})}),e.jsx("div",{className:"animate-in fade-in slide-in-from-bottom-8 duration-1000 delay-150",children:e.jsx("div",{className:"bg-white rounded-3xl shadow-sm border border-slate-100 overflow-hidden",children:e.jsx(se,{vendorStats:S.perVendor,onSelectVendor:N,selectedVendorId:p,summaryMonth:b,setSummaryMonth:j})})}),e.jsxs("div",{className:"pt-12 border-t border-slate-200 animate-in fade-in slide-in-from-bottom-10 duration-1000 delay-300",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-6 mb-8",children:[e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 tracking-tight",children:"Matriks Detail Laporan"}),e.jsxs("p",{className:"text-sm text-slate-500 font-medium",children:["Menampilkan rincian bulanan untuk: ",e.jsx("span",{className:"font-bold text-blue-600 px-2 py-0.5 bg-blue-50 rounded-md",children:L[0]?.name})]})]}),e.jsxs("div",{className:"flex flex-col space-y-2 min-w-[280px]",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest px-1",children:"Filter Berdasarkan Vendor"}),e.jsx("select",{value:p,onChange:r=>N(r.target.value),className:"w-full rounded-xl border border-slate-200 px-4 py-2.5 bg-white text-sm font-bold text-slate-700 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all shadow-sm cursor-pointer hover:border-blue-300",children:u.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))})]})]}),e.jsx(te,{vendors:L,reportTypes:c,uploadLookup:S.uploadLookup,year:s})]})]})};export{ce as default};
