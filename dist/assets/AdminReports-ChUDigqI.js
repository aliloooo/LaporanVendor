import{j as e,s as g}from"./index-FPoq0GoD.js";import{r as l}from"./vendor-C2YDr15k.js";import{f as j,a as O,d as V}from"./adminService-BV-wYqs0.js";import{g as T,n as P,S as k,l as z,f as M,L as U,b as G,h as J,D as L,T as A}from"./ui-hZRiD3mG.js";import"./data-CpkYhZGa.js";import"./toDate-SX-ecmdR.js";const D={uploaded:{label:"Uploaded",color:"text-green-700",bg:"bg-green-100",icon:T},overdue:{label:"Overdue",color:"text-red-700",bg:"bg-red-100",icon:M},pending:{label:"Pending",color:"text-yellow-700",bg:"bg-yellow-100",icon:J}},q=({title:a,message:i,onConfirm:m,onClose:h,loading:c})=>e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:a}),e.jsx("p",{className:"text-slate-500 text-sm mb-6",children:i}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:h,className:"px-4 py-2 border border-slate-300 rounded-lg text-slate-700 hover:bg-slate-50",children:"Batal"}),e.jsxs("button",{onClick:m,disabled:c,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-60 flex items-center gap-2",children:[c&&e.jsx(U,{className:"w-4 h-4 animate-spin"})," Hapus"]})]})]})}),ee=()=>{const[a,i]=l.useState("vendor"),[m,h]=l.useState([]),[c,R]=l.useState([]),[E,b]=l.useState(!0),[N,x]=l.useState(""),[v,y]=l.useState(""),[o,u]=l.useState(""),[f,$]=l.useState("all"),[r,d]=l.useState(null),[I,w]=l.useState(!1),C=async()=>{b(!0),x("");try{const{data:t,error:s}=await g.from("report_uploads").select(`
                    *,
                    vendors ( name ),
                    report_types ( name )
                `).order("uploaded_at",{ascending:!1});if(s)throw s;h(t||[]);const n=await O();R(n||[])}catch(t){console.error("Error loading admin reports:",t),x(t.message)}finally{b(!1)}};l.useEffect(()=>{C()},[]);const B=t=>{y(t),setTimeout(()=>y(""),3e3)},F=async()=>{if(r){w(!0),x("");try{if(a==="vendor"){let t=null;if(r.file_url){const n="/object/public/vendor-reports/",p=r.file_url.indexOf(n);p!==-1&&(t=r.file_url.substring(p+n.length).split("?")[0])}t&&await g.storage.from("vendor-reports").remove([decodeURIComponent(t)]);const{error:s}=await g.from("report_uploads").delete().eq("id",r.id);if(s)throw s}else await V(r.id,r.file_path);B("Laporan berhasil dihapus!"),d(null),await C()}catch(t){x(`Gagal menghapus: ${t.message}`),d(null)}finally{w(!1)}}},S=m.filter(t=>{const s=t.vendors?.name||"",n=t.report_types?.name||"",p=s.toLowerCase().includes(o.toLowerCase())||n.toLowerCase().includes(o.toLowerCase()),H=f==="all"||t.status===f;return p&&H}),_=c.filter(t=>t.title?.toLowerCase().includes(o.toLowerCase())||t.description?.toLowerCase().includes(o.toLowerCase()));return e.jsxs("div",{className:"space-y-6",children:[v&&e.jsxs("div",{className:"fixed top-4 right-4 z-50 bg-green-600 text-white px-4 py-3 rounded-xl shadow-lg flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5"})," ",v]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Report Management"}),e.jsx("p",{className:"text-slate-500 text-sm mt-1",children:"Kelola hasil submit vendor dan laporan internal admin."})]}),e.jsxs("div",{className:"flex bg-slate-100 p-1 rounded-xl w-fit",children:[e.jsxs("button",{onClick:()=>{i("vendor"),u("")},className:`px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 ${a==="vendor"?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[e.jsx(P,{className:"w-4 h-4"})," Laporan Vendor"]}),e.jsxs("button",{onClick:()=>{i("admin"),u("")},className:`px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 ${a==="admin"?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[e.jsx(k,{className:"w-4 h-4"})," Laporan Admin"]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(z,{className:"w-4 h-4 text-slate-400 absolute left-3 top-1/2 -translate-y-1/2"}),e.jsx("input",{type:"text",placeholder:a==="vendor"?"Cari vendor atau jenis laporan...":"Cari judul atau deskripsi...",value:o,onChange:t=>u(t.target.value),className:"w-full pl-9 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm"})]}),a==="vendor"&&e.jsxs("select",{value:f,onChange:t=>$(t.target.value),className:"border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none bg-white",children:[e.jsx("option",{value:"all",children:"Semua Status"}),e.jsx("option",{value:"uploaded",children:"Uploaded"}),e.jsx("option",{value:"overdue",children:"Overdue"}),e.jsx("option",{value:"pending",children:"Pending"})]})]}),N&&e.jsxs("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 rounded-r-lg text-sm text-red-700 flex items-center gap-2",children:[e.jsx(M,{className:"w-4 h-4"})," ",N]}),E?e.jsx("div",{className:"flex justify-center py-24",children:e.jsx(U,{className:"w-8 h-8 animate-spin text-blue-600"})}):e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:a==="vendor"?e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-slate-700",children:"Vendor"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-slate-700",children:"Jenis Laporan"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-slate-700",children:"Bulan"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-slate-700",children:"Upload At"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-slate-700",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-center font-semibold text-slate-700",children:"Aksi"})]}):e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-slate-700",children:"Judul Laporan"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-slate-700",children:"Deskripsi"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-slate-700",children:"Tanggal Upload"}),e.jsx("th",{className:"px-6 py-3 text-center font-semibold text-slate-700",children:"Aksi"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-100",children:[a==="vendor"&&(S.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-24 text-center text-slate-400",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(G,{className:"w-12 h-12 opacity-10"}),e.jsxs("p",{children:["Belum ada laporan vendor",o?" yang sesuai pencarian.":"."]})]})})}):S.map(t=>{const s=D[t.status]||D.pending,n=s.icon;return e.jsxs("tr",{className:"hover:bg-slate-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 font-medium text-slate-900",children:t.vendors?.name||"—"}),e.jsx("td",{className:"px-6 py-4 text-slate-600 truncate max-w-[150px]",children:t.report_types?.name||"—"}),e.jsx("td",{className:"px-6 py-4 text-slate-500 whitespace-nowrap",children:t.report_month?j(new Date(t.report_month),"MMM yyyy"):"—"}),e.jsx("td",{className:"px-6 py-4 text-slate-500 whitespace-nowrap",children:t.uploaded_at?j(new Date(t.uploaded_at),"dd/MM/yy HH:mm"):"—"}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2 py-0.5 rounded-full text-[10px] font-bold uppercase tracking-wider ${s.bg} ${s.color}`,children:[e.jsx(n,{className:"w-3 h-3"})," ",s.label]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[t.file_url&&e.jsx("a",{href:t.file_url,target:"_blank",rel:"noreferrer",className:"p-1.5 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg",children:e.jsx(L,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>d(t),className:"p-1.5 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-lg",children:e.jsx(A,{className:"w-4 h-4"})})]})})]},t.id)})),a==="admin"&&(_.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-6 py-24 text-center text-slate-400",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(k,{className:"w-12 h-12 opacity-10"}),e.jsxs("p",{children:["Belum ada laporan admin",o?" yang sesuai pencarian.":"."]})]})})}):_.map(t=>e.jsxs("tr",{className:"hover:bg-slate-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 font-medium text-slate-900",children:t.title}),e.jsx("td",{className:"px-6 py-4 text-slate-600 max-w-[300px] truncate",children:t.description||"—"}),e.jsx("td",{className:"px-6 py-4 text-slate-500",children:j(new Date(t.created_at),"dd MMM yyyy")}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("a",{href:t.file_url,target:"_blank",rel:"noreferrer",className:"p-1.5 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg",children:e.jsx(L,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>d(t),className:"p-1.5 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-lg",children:e.jsx(A,{className:"w-4 h-4"})})]})})]},t.id)))]})]})})}),r&&e.jsx(q,{title:"Hapus Laporan",message:`Apakah Anda yakin ingin menghapus "${a==="vendor"?r.report_types?.name||"laporan ini":r.title}"?`,onConfirm:F,onClose:()=>d(null),loading:I})]})};export{ee as default};
