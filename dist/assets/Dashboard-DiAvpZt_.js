import{s as S,j as e}from"./index-B9GCynK_.js";import{R as H,r as h}from"./vendor-C2YDr15k.js";import{b as W,g as M,h as R,f as Y,i as q,j as G,L as Q}from"./ui-BsoBaXac.js";import{c as U,d as I}from"./dateHelper-uiqc6hDl.js";import"./data-CpkYhZGa.js";import"./toDate-SX-ecmdR.js";const X=async(s=new Date().getFullYear())=>{try{const{data:i,error:c}=await S.from("vendors").select("id, name").order("name");if(c)throw c;const{data:p,error:u}=await S.from("report_types").select("*").order("id");if(u)throw u;const t=`${s}-01-01`,a=`${s}-12-31`,{data:l,error:r}=await S.from("report_uploads").select("*").gte("report_month",t).lte("report_month",a);if(r)throw r;const g={totalVendors:i.length,totalReports:p.length*i.length,uploaded:l.filter(o=>o.status==="uploaded").length,pending:l.filter(o=>o.status==="pending").length,overdue:l.filter(o=>o.status==="overdue").length},{data:f,error:j}=await S.from("report_uploads").select("report_month");if(j)throw j;const b=new Set(f.map(o=>parseInt(o.report_month.split("-")[0])));b.add(new Date().getFullYear());const v=Array.from(b).sort((o,C)=>C-o);return{uploads:l,summary:g,vendors:i,reportTypes:p,year:s,availableYears:v}}catch(i){throw console.error("Error fetching dashboard data:",i),i}},k=({title:s,count:i,icon:c,colorClass:p,bgColorClass:u,iconColorClass:t})=>e.jsxs("div",{className:"group bg-white rounded-2xl shadow-sm border border-slate-100 p-6 flex items-center space-x-5 transition-all duration-300 hover:shadow-md hover:border-blue-100",children:[e.jsx("div",{className:`p-4 rounded-xl ${u} transition-transform duration-300 group-hover:scale-110`,children:e.jsx(c,{className:`w-7 h-7 ${t}`})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest mb-1",children:s}),e.jsx("p",{className:`text-3xl font-bold tracking-tight ${p}`,children:i})]})]}),Z=({summary:s})=>e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(k,{title:"Total Laporan",count:s.totalReports,icon:W,colorClass:"text-slate-900",bgColorClass:"bg-blue-50",iconColorClass:"text-blue-600"}),e.jsx(k,{title:"Terkirim",count:s.uploaded,icon:M,colorClass:"text-green-600",bgColorClass:"bg-green-50",iconColorClass:"text-green-600"}),e.jsx(k,{title:"Tertunda",count:s.pending,icon:R,colorClass:"text-yellow-600",bgColorClass:"bg-yellow-50",iconColorClass:"text-yellow-600"}),e.jsx(k,{title:"Terlambat",count:s.overdue,icon:Y,colorClass:"text-red-600",bgColorClass:"bg-red-50",iconColorClass:"text-red-600"})]}),P=[{value:1,label:"Jan"},{value:2,label:"Feb"},{value:3,label:"Mar"},{value:4,label:"Apr"},{value:5,label:"May"},{value:6,label:"Jun"},{value:7,label:"Jul"},{value:8,label:"Aug"},{value:9,label:"Sep"},{value:10,label:"Oct"},{value:11,label:"Nov"},{value:12,label:"Dec"}],ee=({status:s})=>{switch(s){case"uploaded":return e.jsx(M,{className:"w-5 h-5 text-green-500 mx-auto",title:"Uploaded"});case"pending":return e.jsx(R,{className:"w-5 h-5 text-yellow-500 mx-auto",title:"Pending"});case"overdue":return e.jsx(Y,{className:"w-5 h-5 text-red-500 mx-auto",title:"Overdue"});default:return e.jsx(q,{className:"w-4 h-4 text-slate-300 mx-auto",title:"Not Uploaded"})}},te=({vendors:s,reportTypes:i,uploads:c,year:p})=>{const u=new Date,t=(a,l,r)=>{const g=new Date(p,r-1,1),f=`${p}-${String(r).padStart(2,"0")}-01`,j=c.find(o=>o.vendor_id===a&&o.report_type_id===l&&o.report_month.startsWith(f.substring(0,7))),b=i.find(o=>o.id===l);if(!b)return null;const v=U(g,b);return j?I(!0,v,j.uploaded_at):g>u?null:"pending"};return e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-4 py-3 font-semibold text-slate-700 min-w-[250px] sticky left-0 bg-slate-50 z-10 border-r border-slate-200",children:"Jenis Laporan"}),P.map(a=>e.jsx("th",{scope:"col",className:"px-2 py-3 font-semibold text-slate-700 text-center min-w-[60px]",children:a.label},a.value))]})}),e.jsx("tbody",{className:"divide-y divide-slate-200",children:s.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"13",className:"px-6 py-8 text-center text-slate-500",children:"Tidak ada data vendor."})}):s.map(a=>e.jsxs(H.Fragment,{children:[e.jsx("tr",{className:"bg-blue-50/50",children:e.jsx("td",{colSpan:"13",className:"px-4 py-2 font-bold text-slate-900 sticky left-0 bg-blue-50/50",children:a.name})}),i.map(l=>e.jsxs("tr",{className:"hover:bg-slate-50/50 transition-colors",children:[e.jsx("td",{className:"px-4 py-2.5 text-slate-600 text-xs font-medium sticky left-0 bg-white group-hover:bg-slate-50 border-r border-slate-100",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:l.name}),e.jsx("span",{className:"text-[10px] text-slate-400 capitalize",children:l.period_type.replace("_"," ")})]})}),P.map(r=>{const g=t(a.id,l.id,r.value);return e.jsx("td",{className:"px-2 py-2.5 text-center border-l border-slate-100",children:e.jsx(ee,{status:g})},`${a.id}-${l.id}-${r.value}`)})]},`${a.id}-${l.id}`))]},a.id))})]})})})},se=({vendorStats:s,onSelectVendor:i,selectedVendorId:c,summaryMonth:p,setSummaryMonth:u})=>e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:[e.jsxs("div",{className:"p-5 border-b border-slate-100 flex flex-col sm:flex-row justify-between items-start sm:items-center bg-slate-50/50 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-800 text-lg",children:"Ringkasan Kepatuhan Vendor"}),e.jsxs("span",{className:"text-sm text-slate-500",children:[s.length," Total Vendor"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 uppercase",children:"Bulan:"}),e.jsxs("select",{value:p,onChange:t=>u(t.target.value),className:"rounded-lg border border-slate-200 px-3 py-1.5 bg-white text-sm font-medium focus:ring-2 focus:ring-blue-500 outline-none transition-colors hover:border-blue-300",children:[e.jsx("option",{value:"all",children:"Semua Bulan"}),Array.from({length:12},(t,a)=>a+1).map(t=>{const a=new Date(2e3,t-1);return e.jsx("option",{value:t,children:a.toLocaleString("id-ID",{month:"long"})},t)})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-slate-50 text-slate-600 font-semibold uppercase text-xs tracking-wider",children:[e.jsx("th",{className:"px-6 py-4",children:"Nama Vendor"}),e.jsx("th",{className:"px-6 py-4 text-center",children:"Persentase"}),e.jsx("th",{className:"px-6 py-4",children:"Uploaded"}),e.jsx("th",{className:"px-6 py-4",children:"Overdue"}),e.jsx("th",{className:"px-6 py-4",children:"Pending"}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Aksi"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:s.map(t=>{const a=t.totalReports>0?Math.round(t.uploaded/t.totalReports*100):0,l=t.id===c;return e.jsxs("tr",{className:`group hover:bg-blue-50/40 transition-colors duration-200 ${l?"bg-blue-50/60 border-l-4 border-blue-500":"border-l-4 border-transparent"}`,children:[e.jsx("td",{className:"px-6 py-4 font-medium text-slate-900",children:t.name}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("div",{className:"flex-1 min-w-[60px] h-2 bg-slate-100 rounded-full overflow-hidden max-w-[100px] group-hover:h-2.5 transition-all",children:e.jsx("div",{className:`h-full rounded-full transition-all duration-500 ${a>=90?"bg-green-500":a>=70?"bg-yellow-500":"bg-red-500"}`,style:{width:`${a}%`}})}),e.jsxs("span",{className:"font-semibold text-slate-700 whitespace-nowrap",children:[a,"%"]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center text-green-600 font-medium",children:[e.jsx(M,{className:"w-4 h-4 mr-1.5"}),t.uploaded]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center text-red-600 font-medium",children:[e.jsx(Y,{className:"w-4 h-4 mr-1.5"}),t.overdue]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center text-yellow-600 font-medium",children:[e.jsx(R,{className:"w-4 h-4 mr-1.5"}),t.pending]})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("button",{onClick:()=>i(t.id),className:`inline-flex items-center px-3 py-1.5 rounded-lg text-sm font-semibold transition-all ${l?"bg-blue-600 text-white shadow-md":"bg-white text-blue-600 border border-blue-200 hover:bg-blue-50"}`,children:[l?"Melihat Matriks":"Detail",!l&&e.jsx(G,{className:"w-4 h-4 ml-1"})]})})]},t.id)})})]})}),s.length===0&&e.jsx("div",{className:"p-10 text-center text-slate-500 italic",children:"Belum ada data statistik untuk tahun ini."})]}),ce=()=>{const[s,i]=h.useState([]),[c,p]=h.useState([]),[u,t]=h.useState([]),[a,l]=h.useState(null),[r,g]=h.useState(new Date().getFullYear()),[f,j]=h.useState("all"),[b,v]=h.useState(""),[o,C]=h.useState([new Date().getFullYear()]),[D,T]=h.useState(!0);h.useEffect(()=>{(async()=>{try{const m=await X(r);i(m.uploads),p(m.vendors),t(m.reportTypes),m.vendors.length>0&&!b&&v(m.vendors[0].id),C(m.availableYears||[r]),l(m.summary),g(m.year)}catch(m){console.error("Failed to load dashboard data",m)}finally{T(!1)}})()},[r]);const _=h.useMemo(()=>{if(D||c.length===0||u.length===0)return{global:null,perVendor:[]};const n=new Date,m=n.getFullYear(),B=n.getMonth()+1,E=new Map;s.forEach(d=>{if(d.report_month){const x=d.report_month.substring(0,7),y=`${d.vendor_id}_${d.report_type_id}_${x}`;E.set(y,d)}});const w=c.map(d=>{let x=0,y=0,$=0;return u.forEach(F=>{for(let N=1;N<=12;N++){const J=`${r}-${String(N).padStart(2,"0")}`,O=new Date(r,N-1,1);if(f!=="all"&&N!==parseInt(f,10)||r>m||r===m&&N>B)continue;const z=`${d.id}_${F.id}_${J}`,L=E.get(z);if(L){const K=U(O,F),A=I(!0,K,L.uploaded_at);A==="uploaded"?x++:A==="overdue"&&$++}else y++}}),{id:d.id,name:d.name,uploaded:x,overdue:$,pending:y,totalReports:x+$+y}});return{global:{totalReports:w.reduce((d,x)=>d+(x.uploaded+x.overdue),0),uploaded:w.reduce((d,x)=>d+x.uploaded,0),pending:w.reduce((d,x)=>d+x.pending,0),overdue:w.reduce((d,x)=>d+x.overdue,0)},perVendor:w}},[s,c,u,r,D,f]);if(D)return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] text-slate-500",children:[e.jsx(Q,{className:"w-8 h-8 animate-spin mb-4 text-blue-600"}),e.jsx("p",{children:"Loading dashboard data..."})]});const V=c.filter(n=>n.id===b);return e.jsxs("div",{className:"space-y-10 pb-16",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-6",children:[e.jsxs("div",{className:"flex flex-col space-y-2 border-l-4 border-blue-600 pl-6 py-1",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight text-slate-900",children:"Dashboard Monitoring"}),e.jsx("p",{className:"text-slate-500 font-medium",children:"Ringkasan eksekutif dan matriks kepatuhan laporan vendor."})]}),e.jsxs("div",{className:"bg-white p-2 rounded-2xl shadow-sm border border-slate-100 flex items-center gap-3",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest pl-3",children:"Periode"}),e.jsx("select",{value:r,onChange:n=>{T(!0),g(Number(n.target.value))},className:"rounded-xl border-none px-4 py-2 bg-slate-50 text-slate-800 text-sm font-bold focus:ring-2 focus:ring-blue-500 outline-none transition-all cursor-pointer hover:bg-slate-100",children:o.map(n=>e.jsxs("option",{value:n,children:["Tahun ",n]},n))})]})]}),_.global&&e.jsx("div",{className:"animate-in fade-in slide-in-from-bottom-4 duration-700",children:e.jsx(Z,{summary:_.global})}),e.jsx("div",{className:"animate-in fade-in slide-in-from-bottom-8 duration-1000 delay-150",children:e.jsx("div",{className:"bg-white rounded-3xl shadow-sm border border-slate-100 overflow-hidden",children:e.jsx(se,{vendorStats:_.perVendor,onSelectVendor:v,selectedVendorId:b,summaryMonth:f,setSummaryMonth:j})})}),e.jsxs("div",{className:"pt-12 border-t border-slate-200 animate-in fade-in slide-in-from-bottom-10 duration-1000 delay-300",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-6 mb-8",children:[e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 tracking-tight",children:"Matriks Detail Laporan"}),e.jsxs("p",{className:"text-sm text-slate-500 font-medium",children:["Menampilkan rincian bulanan untuk: ",e.jsx("span",{className:"font-bold text-blue-600 px-2 py-0.5 bg-blue-50 rounded-md",children:V[0]?.name})]})]}),e.jsxs("div",{className:"flex flex-col space-y-2 min-w-[280px]",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest px-1",children:"Filter Berdasarkan Vendor"}),e.jsx("select",{value:b,onChange:n=>v(n.target.value),className:"w-full rounded-xl border border-slate-200 px-4 py-2.5 bg-white text-sm font-bold text-slate-700 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all shadow-sm cursor-pointer hover:border-blue-300",children:c.map(n=>e.jsx("option",{value:n.id,children:n.name},n.id))})]})]}),e.jsx(te,{vendors:V,reportTypes:u,uploads:s,year:r})]})]})};export{ce as default};
